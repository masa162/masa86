{{ define "main" }}
<div class="search-page">
  <h1>検索結果</h1>
  <div id="search-input-container">
    <input type="text" id="search-input" placeholder="検索キーワードを入力..." class="search-input">
    <button id="search-button" class="search-button">検索</button>
  </div>
  <div id="search-results">
    <p>検索キーワードを入力してください。</p>
  </div>
</div>

<script>
// 検索機能
function performSearch(query) {
  if (!query || query.trim() === '') {
    document.getElementById('search-results').innerHTML = '<p>検索キーワードを入力してください。</p>';
    return;
  }

  // 全ページデータを取得
  fetch('/index.json')
    .then(response => response.json())
    .then(pages => {
      const results = pages.filter(page => {
        const searchText = (page.title + ' ' + page.content).toLowerCase();
        return searchText.includes(query.toLowerCase());
      });

      displayResults(results, query);
    })
    .catch(error => {
      console.error('検索エラー:', error);
      document.getElementById('search-results').innerHTML = '<p>検索中にエラーが発生しました。</p>';
    });
}

function displayResults(results, query) {
  const container = document.getElementById('search-results');
  
  if (results.length === 0) {
    container.innerHTML = `<p>"${query}" に関する記事が見つかりませんでした。</p>`;
    return;
  }

  let html = `<h2>${results.length}件の記事が見つかりました</h2>`;
  results.forEach(page => {
    html += `
      <article class="search-result-item">
        <h3><a href="${page.permalink}">${page.title}</a></h3>
        <p class="search-result-date">${page.date}</p>
        <p class="search-result-summary">${page.summary}</p>
      </article>
    `;
  });
  
  container.innerHTML = html;
}

// イベントリスナー
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('search-input');
  const searchButton = document.getElementById('search-button');
  
  // URL パラメータから検索クエリを取得
  const urlParams = new URLSearchParams(window.location.search);
  const query = urlParams.get('q');
  
  if (query) {
    searchInput.value = query;
    performSearch(query);
  }
  
  // 検索ボタンクリック
  searchButton.addEventListener('click', function() {
    const query = searchInput.value.trim();
    if (query) {
      performSearch(query);
      // URLを更新
      const newUrl = window.location.pathname + '?q=' + encodeURIComponent(query);
      window.history.pushState({}, '', newUrl);
    }
  });
  
  // Enterキーで検索
  searchInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      searchButton.click();
    }
  });
});
</script>

<style>
.search-page {
  max-width: 100%;
}

#search-input-container {
  display: flex;
  gap: 10px;
  margin: 20px 0;
}

#search-input {
  flex: 1;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 16px;
}

#search-button {
  padding: 10px 20px;
  background-color: #0066cc;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

#search-button:hover {
  background-color: #004499;
}

.search-result-item {
  margin: 20px 0;
  padding: 15px 0;
  border-bottom: 1px solid #eee;
}

.search-result-item h3 {
  margin: 0 0 5px 0;
}

.search-result-item h3 a {
  color: #0066cc;
  text-decoration: none;
}

.search-result-item h3 a:hover {
  color: #004499;
}

.search-result-date {
  color: #666;
  font-size: 14px;
  margin: 5px 0;
}

.search-result-summary {
  color: #333;
  line-height: 1.5;
}
</style>
{{ end }}