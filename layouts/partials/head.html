<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
{{- if hugo.IsProduction | or (eq site.Params.env "production") | and (ne .Params.robotsNoIndex true) }}
<meta name="robots" content="index, follow">
{{- else }}
<meta name="robots" content="noindex, nofollow">
{{- end }}

<title>{{ if .IsHome }}{{ else }}{{ if .Title }}{{ .Title }} | {{ end }}{{ end }}{{ site.Title }}</title>

{{- if .IsHome }}
{{ with site.Params.keywords -}}<meta name="keywords" content="{{- range $i, $e := . }}{{ if $i }}, {{ end }}{{ $e }}{{ end }}">{{ end }}
{{- else }}
<meta name="keywords" content="{{ if .Params.keywords -}}
    {{- range $i, $e := .Params.keywords }}{{ if $i }}, {{ end }}{{ $e }}{{ end }} {{- else }}
    {{- range $i, $e := .Params.tags }}{{ if $i }}, {{ end }}{{ $e }}{{ end }} {{- end -}}">
{{- end }}
<meta name="description" content="{{- with .Description }}{{ . }}{{- else }}{{- if or .IsPage .IsSection}}
    {{- .Summary | default (printf "%s - %s" .Title  site.Title) }}{{- else }}
    {{- with site.Params.description }}{{ . }}{{- end }}{{- end }}{{- end -}}">
<link rel="canonical" href="{{ if .Params.canonicalURL -}} {{ trim .Params.canonicalURL " " }} {{- else -}} {{ .Permalink }} {{- end }}">
{{- if site.Params.analytics.google.SiteVerificationTag }}
<meta name="google-site-verification" content="{{ site.Params.analytics.google.SiteVerificationTag }}">
{{- end }}
{{- if site.Params.analytics.yandex.SiteVerificationTag }}
<meta name="yandex-verification" content="{{ site.Params.analytics.yandex.SiteVerificationTag }}">
{{- end }}
{{- if site.Params.analytics.bing.SiteVerificationTag }}
<meta name="msvalidate.01" content="{{ site.Params.analytics.bing.SiteVerificationTag }}">
{{- end }}
{{- if site.Params.analytics.naver.SiteVerificationTag }}
<meta name="naver-site-verification" content="{{ site.Params.analytics.naver.SiteVerificationTag }}">
{{- end }}

{{- /* Styles */}}
{{- $includes := slice }}
{{- $scrollStyle := resources.Get "css/includes/scroll-bar.css" }}
{{- if $scrollStyle }}
  {{- $includes = $includes | append $scrollStyle }}
{{- end }}
{{- $includes_all := "" }}
{{- if gt (len $includes) 0 }}
  {{- $includes_all = $includes | resources.Concat "assets/css/includes.css" }}
{{- end }}

{{- $theme_vars := resources.Get "css/core/theme-vars.css" }}
{{- $reset := resources.Get "css/core/reset.css" }}
{{- $media := resources.Get "css/core/zmedia.css" }}
{{- $license_css := resources.Get "css/core/license.css" }}
{{- $common_files := resources.Match "css/common/*.css" }}
{{- $common := "" }}
{{- if gt (len $common_files) 0 }}
  {{- $common = $common_files | resources.Concat "assets/css/common.css" }}
{{- end }}
{{- $chroma_styles := resources.Get "css/includes/chroma-styles.css" }}
{{- $chroma_mod := resources.Get "css/includes/chroma-mod.css" }}
{{- $coreParts := slice $theme_vars $reset }}
{{- if $common }}{{ $coreParts = $coreParts | append $common }}{{ end }}
{{- $coreParts = $coreParts | append $chroma_styles $chroma_mod }}
{{- if $includes_all }}{{ $coreParts = $coreParts | append $includes_all }}{{ end }}
{{- $coreParts = $coreParts | append $media }}
{{- $core := $coreParts | resources.Concat "assets/css/core.css" | resources.Minify }}

{{- $extended_files := resources.Match "css/extended/*.css" }}
{{- $extended := "" }}
{{- if gt (len $extended_files) 0 }}
  {{- $extended = $extended_files | resources.Concat "assets/css/extended.css" | resources.Minify }}
{{- end }}

{{- $styleParts := slice $license_css $core }}
{{- if $extended }}{{ $styleParts = $styleParts | append $extended }}{{ end }}
{{- $stylesheet := $styleParts | resources.Concat "assets/css/stylesheet.css" }}

{{- if not site.Params.assets.disableFingerprinting }}
{{- $stylesheet = $stylesheet | fingerprint }}
<link crossorigin="anonymous" href="{{ $stylesheet.RelPermalink }}" integrity="{{ $stylesheet.Data.Integrity }}" rel="preload stylesheet" as="style">
{{- else }}
<link crossorigin="anonymous" href="{{ $stylesheet.RelPermalink }}" rel="preload stylesheet" as="style">
{{- end }}

{{- $navStyle := resources.Get "css/override/nav.css" | resources.Minify }}
<link rel="stylesheet" href="{{ $navStyle.RelPermalink }}">

{{- /* Favicons */}}
<link rel="icon" href="{{ site.Params.assets.favicon | default "favicon.ico" | absURL }}">
<link rel="icon" type="image/png" sizes="16x16" href="{{ site.Params.assets.favicon16x16 | default "favicon-16x16.png" | absURL }}">
<link rel="icon" type="image/png" sizes="32x32" href="{{ site.Params.assets.favicon32x32 | default "favicon-32x32.png" | absURL }}">
<link rel="apple-touch-icon" href="{{ site.Params.assets.apple_touch_icon | default "apple-touch-icon.png" | absURL }}">
<link rel="mask-icon" href="{{ site.Params.assets.safari_pinned_tab | default "safari-pinned-tab.svg" | absURL }}">
<meta name="theme-color" content="{{ site.Params.assets.theme_color | default "#2e2e33" }}">
<meta name="msapplication-TileColor" content="{{ site.Params.assets.msapplication_TileColor | default "#2e2e33" }}">

{{ range .AlternativeOutputFormats -}}
<link rel="{{ .Rel }}" type="{{ .MediaType.Type | html }}" href="{{ .Permalink | safeURL }}">
{{ end -}}
{{- range .AllTranslations -}}
<link rel="alternate" hreflang="{{ .Lang }}" href="{{ .Permalink }}">
{{ end -}}

<noscript>
  <style>
    #theme-toggle, .top-link { display: none; }
  </style>
</noscript>

<style>
  .toggle-content {
    overflow: hidden;
    max-height: 0;
    transition: max-height 0.4s ease;
    margin-left: 1rem;
    padding: 0.5rem 0;
  }

  .toggle-content.open {
    max-height: 1000px;
  }

  .toggle-btn {
    background: none;
    border: none;
    font-weight: bold;
    cursor: pointer;
    padding: 0.3rem 0;
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .toggle-btn .icon {
    display: inline-block;
    transition: transform 0.3s ease;
  }

  .toggle-btn.open .icon {
    transform: rotate(90deg);
  }
</style>

<script>
  (function () {
    const userPref = localStorage.getItem('pref-theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const isDark = userPref === 'dark' || (!userPref && prefersDark);
    if (isDark) {
      document.body.classList.add('dark');
    } else {
      document.body.classList.remove('dark');
    }
  })();
</script>

{{- partial "extend_head.html" . -}}

{{- if hugo.IsProduction | or (eq site.Params.env "production") }}
<meta property="og:title" content="{{ .Title | default site.Title }}" />
<meta property="og:description" content="{{ .Params.description | default site.Params.description }}" />
<meta property="og:type" content="website" />
<meta property="og:url" content="{{ .Permalink }}" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="{{ .Title | default site.Title }}" />
<meta name="twitter:description" content="{{ .Params.description | default site.Params.description }}" />
<meta name="twitter:site" content="@your_twitter_id">
{{- partial "google_analytics.html" . }}
{{- partial "templates/schema_json.html" . }}
{{- end }}
